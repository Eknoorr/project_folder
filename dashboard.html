<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Smart Attendance Tracker</title>
    <style>
        /* Basic spinner for loading overlay */
        #loading-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(255, 255, 255, 0.75);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: red;
        }
        .warning {
            color: orange;
            border: 1px solid orange;
            padding: 8px;
        }
    </style>
</head>
<body>

    <div>
        
        <!-- Loading Overlay -->
        <div id="loading-overlay" style="display:none;">
            <div class="spinner"></div>
            <p id="loading-text">Loading...</p>
        </div>

        <!-- App Header -->
        <div id="app-header">
            <h1>My Attendance Dashboard</h1>
            <button id="logout-button">Logout</button>
        </div>

        <!-- Onboarding View -->
        <div id="onboarding-view" class="view" style="display:block;">
            <h2>Initial Setup</h2>
            <p>Welcome! Please provide the following details to get started.</p>
            <form id="setup-form">
                <div>
                    <label for="start-date">Semester Start Date:</label>
                    <input type="date" id="start-date" required>
                </div>
                <div>
                    <label for="min-attendance">Minimum Attendance Percentage:</label>
                    <input type="number" id="min-attendance" value="75" min="1" max="100" required>
                </div>
                <div>
                    <label for="timetable-pdf">Upload Timetable (PDF):</label>
                    <input type="file" id="timetable-pdf" accept=".pdf" required>
                </div>
                <button type="submit">Save and Continue</button>
            </form>
            <p id="setup-error" class="error-message"></p>
        </div>

        <!-- Main Dashboard View -->
        <div id="dashboard-view" class="view" style="display:none;">
            <!-- Attendance Summary Section -->
            <div id="attendance-summary">
                <!-- Detailed Theory/Lab table will be injected here by app.js -->
                 <p>Your attendance summary will appear here.</p>
            </div>

            <!-- Actions Section -->
            <div id="actions-section">
                <h2>Mark Attendance</h2>
                <div class="date-selector">
                    <label for="historical-date">Select Date:</label>
                    <input type="date" id="historical-date">
                </div>
                <div id="daily-log-container">
                    <!-- Daily log options will be injected here by app.js -->
                    <p>Select a date to see lecture options.</p>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div id="settings-section">
                <h2>Settings</h2>
                <form id="update-timetable-form">
                    <label for="update-timetable-pdf">Re-upload Timetable (PDF):</label>
                    <div class="warning">
                        <p><strong>Warning</strong></p>
                        <p>Re-uploading will reset all your attendance data.</p>
                    </div>
                    <input type="file" id="update-timetable-pdf" accept=".pdf" required>
                    <button type="submit">Update Timetable</button>
                </form>
            </div>
        </div>
    </div>

    <!-- SCRIPT LOADING AND SETUP -->
    <!--
      IMPORTANT:
      The old script tags for pdf.js and pdf.worker.js have been removed.
      The modern ES Module import below now handles everything.
    -->
    <script type="module">
        // 1. Import the library from the CDN using the ES Module version (.mjs)
        import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.min.mjs';

        // 2. Set the path to the worker file, also from the CDN
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.4.168/pdf.worker.min.mjs';

        // 3. Make the library object globally available for your app.js script to use
        window.pdfjsLib = pdfjsLib;
    </script>
    
    <!-- Your existing scripts can now use the globally available pdfjsLib -->
    <script src="js/netlify.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
